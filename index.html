<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Court Excel Manager</title>
<script src="./xlsx.full.min.js"></script>

<style>
body { font-family: Arial; padding: 20px; }
#status { margin-top: 15px; font-weight: bold; }
.success { color: green; }
.error { color: red; }
</style>
</head>

<body>

<h2>Excel Party Name Processor</h2>

<input type="file" id="fileInput" accept=".xlsx,.xls">
<br><br>
<button onclick="processExcel()">Upload ‚Üí Convert ‚Üí Save</button>

<div id="status"></div>

<hr>
<h3>üìÖ Date-wise Saved Work</h3>
<ul id="history"></ul>

<script>
function setStatus(msg, type="success") {
  const s = document.getElementById("status");
  s.innerText = msg;
  s.className = type;
}

function todayKey() {
  return new Date().toISOString().slice(0,10); // YYYY-MM-DD
}

function loadHistory() {
  const list = document.getElementById("history");
  list.innerHTML = "";

  Object.keys(localStorage).forEach(key => {
    if (key.startsWith("COURT_")) {
      const li = document.createElement("li");
      li.innerText = key.replace("COURT_", "");
      list.appendChild(li);
    }
  });
}

function processExcel() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) {
    setStatus("‚ùå Excel file not selected", "error");
    return;
  }

  setStatus("‚úÖ Excel file uploaded");

  const reader = new FileReader();

  reader.onload = function(e) {
    try {
      setStatus("‚è≥ Processing started...");

      const wb = XLSX.read(e.target.result, { type: "array" });
      const ws = wb.Sheets[wb.SheetNames[0]];
      let data = XLSX.utils.sheet_to_json(ws, { defval: "" });

      const COL = "Party Name";   // üëà column name

      data.forEach(row => {
        if (row[COL]) {
          row[COL] = "TEST_" + row[COL]; // visible change
        }
      });

      // save date-wise
      const key = "COURT_" + todayKey();
      let old = JSON.parse(localStorage.getItem(key) || "[]");
      old.push({
        time: new Date().toLocaleTimeString(),
        rows: data.length,
        file: file.name
      });
      localStorage.setItem(key, JSON.stringify(old));

      // create output
      const newWs = XLSX.utils.json_to_sheet(data);
      const newWb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(newWb, newWs, "Result");
      XLSX.writeFile(newWb, "Converted_" + todayKey() + ".xlsx");

      setStatus("‚úÖ File converted & saved successfully");
      loadHistory();

    } catch (err) {
      setStatus("‚ùå Error: " + err.message, "error");
    }
  };

  reader.readAsArrayBuffer(file);
}

loadHistory();
</script>

</body>
</html>
