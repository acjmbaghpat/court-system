<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Court File Manager</title>

<!-- Barcode Library -->
<script src="https://unpkg.com/html5-qrcode"></script>

<!-- Excel Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{
  font-family:Arial;
  background:#f4f6f8;
  padding:10px;
}
input,button{
  width:100%;
  padding:8px;
  margin:5px 0;
}
button{
  background:#1976d2;
  color:#fff;
  border:none;
  border-radius:4px;
}
#msg{
  position:fixed;
  top:15px;
  right:15px;
  padding:10px 15px;
  color:#fff;
  display:none;
  border-radius:4px;
}
.success{background:#2e7d32;}
.error{background:#c62828;}
#reader{width:100%;}
</style>
</head>

<body>

<h3>Court File Manager</h3>

<input id="diary" placeholder="Diary No">
<input id="party" placeholder="Party Name">
<input id="section" placeholder="Section">
<input id="ps" placeholder="Police Station">

<button onclick="receiveFile()">Receive File</button>
<button onclick="sendFile()">Send File</button>

<button onclick="startScan()">Scan Barcode</button>
<div id="reader"></div>

<input type="file" id="excel" />
<button onclick="uploadExcel()">Upload Excel</button>
<button onclick="downloadExcel()">Download Today Excel</button>

<div id="msg"></div>

<script>
function showMsg(text,type){
 let m=document.getElementById("msg");
 m.innerText=text;
 m.className=type;
 m.style.display="block";
 setTimeout(()=>m.style.display="none",2500);
}

function todayKey(){
 return "court_"+new Date().toISOString().split("T")[0];
}

function receiveFile(){
 try{
  let key=todayKey();
  let data=JSON.parse(localStorage.getItem(key))||[];
  data.push({
    diary:diary.value,
    party:party.value,
    section:section.value,
    ps:ps.value,
    status:"Received",
    time:new Date().toLocaleTimeString()
  });
  localStorage.setItem(key,JSON.stringify(data));
  showMsg("File Received & Saved ‚úÖ","success");
 }catch{
  showMsg("Receive Error ‚ùå","error");
 }
}

function sendFile(){
 try{
  let key=todayKey();
  let data=JSON.parse(localStorage.getItem(key))||[];
  data.push({
    diary:diary.value,
    status:"Sent",
    time:new Date().toLocaleTimeString()
  });
  localStorage.setItem(key,JSON.stringify(data));
  showMsg("File Sent & Saved ‚úÖ","success");
 }catch{
  showMsg("Sent Error ‚ùå","error");
 }
}

/* BARCODE */
function startScan(){
 let html5QrCode = new Html5Qrcode("reader");
 html5QrCode.start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  code => {
    diary.value=code;
    showMsg("Barcode Scanned ‚úî","success");
    html5QrCode.stop();
  }
 );
}

/* EXCEL UPLOAD */
function uploadExcel(){
 let file=document.getElementById("excel").files[0];
 if(!file){showMsg("No Excel Selected ‚ùå","error");return;}
 let reader=new FileReader();
 reader.onload=e=>{
  let wb=XLSX.read(e.target.result,{type:"binary"});
  let sheet=wb.Sheets[wb.SheetNames[0]];
  let data=XLSX.utils.sheet_to_json(sheet);
  localStorage.setItem(todayKey(),JSON.stringify(data));
  showMsg("Excel Uploaded Successfully üìÅ","success");
 };
 reader.readAsBinaryString(file);
}

/* EXCEL DOWNLOAD */
function downloadExcel(){
 let data=JSON.parse(localStorage.getItem(todayKey()))||[];
 if(data.length==0){showMsg("No Data Today ‚ùå","error");return;}
 let ws=XLSX.utils.json_to_sheet(data);
 let wb=XLSX.utils.book_new();
 XLSX.utils.book_append_sheet(wb,ws,"Today");
 XLSX.writeFile(wb,"Court_"+todayKey()+".xlsx");
 showMsg("Excel Downloaded ‚úî","success");
}
</script>

</body>
</html>
